# 會議室預約 Agent

專業的會議室預約助理，使用 Google ADK 框架建立，整合完整的會議室管理功能。

## 功能特色

- ✅ **自動識別使用者身份** - 不需要使用者手動輸入員工編號
- 🏢 **大樓查詢** - 查看所有可預約的大樓
- 🚪 **會議室查詢** - 依大樓和日期查詢可用會議室及時段
- 📅 **會議室預約** - 快速預約會議室
- 📋 **預約管理** - 查詢和取消已預約的會議室

## 快速開始

### 啟動 API Server

```bash
uv run uvicorn api_server:app --host 0.0.0.0 --port 8000 --reload
```

### API 呼叫範例

```bash
curl -X POST "http://localhost:8000/agents/meeting_room/chat" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "EMP001",
    "message": "幫我查詢 A 棟明天有哪些會議室可以預約"
  }'
```

## 可用工具

| 工具 | 說明 | 需要 user_id |
|------|------|:------------:|
| `get_current_user` | 查詢目前登入的使用者資料 | - |
| `list_buildings` | 查詢所有可預約的大樓 | - |
| `list_available_rooms` | 查詢指定大樓在指定日期的可預約會議室 | - |
| `book_room` | 預約會議室 | ✅ 自動注入 |
| `get_my_bookings` | 查詢使用者已預約的會議室 | ✅ 自動注入 |
| `cancel_booking` | 取消會議室預約 | ✅ 自動注入 |

## 對話範例

### 查詢大樓

```
使用者: 有哪些大樓可以預約？
Agent:  目前有 3 棟大樓可供預約：
        1. A棟 - 總部大樓（10 層）
        2. B棟 - 研發中心（8 層）
        3. C棟 - 會議中心（5 層）
```

### 查詢會議室

```
使用者: 查詢 A 棟明天的會議室
Agent:  A棟 - 總部大樓 在 2025-12-17 共有 3 間會議室：

        📍 A-101 大會議室（容納 20 人）
        可用時段：09:00-10:00, 10:00-11:00, 14:00-15:00
        
        📍 A-102 小會議室A（容納 8 人）
        可用時段：全天可用
        
        📍 A-201 董事會議室（容納 30 人）
        可用時段：09:00-10:00, 15:00-16:00
```

### 預約會議室

```
使用者: 幫我預約明天 A-101 10:00-11:00，主題是專案進度會議
Agent:  ✅ 預約成功！

        📋 預約資訊
        ━━━━━━━━━━━━━━━━━━━
        預約編號：BK202512170001
        會議室：A-101 大會議室
        日期：2025-12-17
        時段：10:00-11:00
        主題：專案進度會議
        預約人：王小明（EMP001）
```

### 查詢我的預約

```
使用者: 查詢我的預約
Agent:  王小明，您目前有 2 筆預約：

        1️⃣ BK202512170001
           📍 A-101 大會議室
           📅 2025-12-17 10:00-11:00
           📝 專案進度會議

        2️⃣ BK202512180002
           📍 B-101 研發討論室
           📅 2025-12-18 14:00-15:00
           📝 技術分享會
```

### 取消預約

```
使用者: 取消 BK202512170001
Agent:  ✅ 已成功取消預約 BK202512170001
        （A-101 大會議室，2025-12-17 10:00-11:00）
```

## 時段說明

可預約時段（每個時段 1 小時）：

| 上午 | 下午 |
|------|------|
| 09:00-10:00 | 13:00-14:00 |
| 10:00-11:00 | 14:00-15:00 |
| 11:00-12:00 | 15:00-16:00 |
| - | 16:00-17:00 |
| - | 17:00-18:00 |

## 測試使用者

系統內建以下測試使用者：

| 員工編號 | 姓名 | 部門 |
|---------|------|------|
| EMP001 | 王小明 | 資訊部 |
| EMP002 | 李小華 | 人資部 |
| EMP003 | 張大偉 | 業務部 |
| EMP004 | 陳美玲 | 財務部 |
| EMP005 | 林志豪 | 研發部 |

## 架構說明

```
meeting_room_agent/
├── __init__.py      # 模組匯出
├── agent.py         # Agent 定義和 Instruction
└── tools.py         # 5 個核心工具實作

shared/
├── __init__.py
└── user_service.py  # 共用使用者服務
```

### 使用者資料流程

1. 外部系統呼叫 API 時傳入 `user_id`
2. `api_server.py` 透過 `user_service` 查詢完整使用者資料
3. 使用者資料注入到 Session state
4. Agent 的 `before_tool_callback` 自動將 `user_id` 注入到需要的工具
5. 工具執行時直接使用，不需詢問使用者

## 相關文件

- [使用者資料注入機制說明](../docs/USER_INJECTION_GUIDE.md)
- [API 文件](../API_DOCS.md)
